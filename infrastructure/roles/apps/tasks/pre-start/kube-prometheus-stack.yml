---
- name: Install prometheus CRDs
  kubernetes.core.k8s:
    resource_definition: "{{ lookup('url', url, split_lines=false) }}"
  when: lookup('kubernetes.core.k8s', api_version='apiextensions.k8s.io/v1', kind='CustomResourceDefinition', name=resource+'.monitoring.coreos.com') == []
  loop: 
        # - alertmanagerconfigs
        - Alertmanagers
        - podmonitors
        - probes
        - prometheusagents
        - prometheuses
        - prometheusrules
        - scrapeconfigs
        - servicemonitors
        - thanosrulers
  loop_control:
    loop_var: resource
  vars:
    url: "https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/{{ prometheus_operator_version }}/example/prometheus-operator-crd/monitoring.coreos.com_{{ resource }}.yaml"
