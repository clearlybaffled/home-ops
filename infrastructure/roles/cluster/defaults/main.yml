---
app_template: &app_template
  chart: bjw-s/app-template
  version: "{{ app_template_version }}"

apps:
  argocd:
    namespace: argocd
    wave: 0
    path: ''
    kustomize:
      resources:
        - "https://github.com/cert-manager/cert-manager/releases/download/{{ cert_manager_version }}/cert-manager.crds.yaml"
        - ns.yaml
        - parche-git-repo.yaml
      charts:
        - chart: argocd/argo-cd
          version: "{{ argocd_chart_version }}"
          namespace: argocd
          release: argocd
        - chart: prometheus-community/prometheus-operator-crds
          version: "{{ prometheus_crds_chart_version }}"
          namespace: monitoring

  kube-prometheus-stack:
    namespace: monitoring
    wave: 2
    sources:
      - chart: prometheus-community/kube-prometheus-stack
        version: "{{ kube_prometheus_stack_chart_version }}"
        release: prometheus
        valueFiles:
          - operator.yaml
      - chart: prometheus-community/prometheus-adapter
        version: "{{ prometheus_adapter_chart_version }}"
        valueFiles:
          - adapter.yaml

  hajimari:
    namespace: home
    wave: 4
    sources:
      - chart: hajimari/hajimari
        version: "{{ hajimari_version }}"

  cloudnative-pg:
    namespace: db
    wave: 3
    sources:
      - chart: cnpg/cloudnative-pg
        version: "{{ cnpg_chart_version }}"

  mysql:
    namespace: db
    wave: 3
    pv: true
    sources:
      - chart: bitnami/mysql
        version: "{{ bitnami_mysql_chart_version }}"

  cert-manager:
    path: infrastructure
    namespace: cert-manager
    wave: 1
    sources:
      - chart: jetstack/cert-manager
        version: "{{ cert_manager_version }}"
        skipCrds: true
      - chart: jetstack/trust-manager
        version: "{{ trust_manager_version }}"
        valueFiles: []

  grocy:
    namespace: home
    wave: 4
    pv: true

  ingress-nginx:
    namespace: infrastructure
    wave: 1
    sources:
      - chart: ingress-nginx/ingress-nginx
        version: "{{ ingress_nginx_version }}"

  metallb:
    path: infrastructure
    namespace: metallb-system
    wave: 1
    sources:
      - chart: metallb/metallb
        version: "{{ metallb_version[1:] }}"

  redis:
    namespace: db
    wave: 3
    sources:
      - chart: bitnami/redis
        version: "{{ bitnami_redis_chart_version }}"

  rook-ceph:
    path: infrastructure
    namespace: rook-ceph
    wave: 2
    sources:
      - chart: rook/rook-ceph
        version: "{{ rook_ceph_version }}"
        valueFiles:
          - operator.yaml
      - chart: rook/rook-ceph-cluster
        version: "{{ rook_ceph_version }}"
        valueFiles:
          - ceph-cluster.yaml

  paperless-ngx:
    namespace: home
    wave: 4
    sources:
      - <<: *app_template
        release: paperless-ngx
    pvc:
      - size: 30Gi
        storageClass: ceph-filesystem
        volumeName: paperless-ngx-library

  nextcloud:
    namespace: home
    wave: 4
    sources:
      - chart: nextcloud/nextcloud
        version: "{{ nextcloud_chart_version }}"

  mealie:
    namespace: home
    wave: 4
    sources:
      - chart: k8s-at-home/mealie
        version: 5.1.2
    pvc:
      - size: 10Gi
        storageClass: ceph-block
        volumeName: mealie-api-data
        accessMode: ReadWriteOnce

  heimdall:
    namespace: home
    sources:
      - chart: k8s-at-home/heimdall
        version: 8.4.2

  vault:
    path: infrastructure
    namespace: vault
    sources:
      - chart: hashicorp/vault
        version: "{{ vault_chart_version }}"

  qbittorrent:
    namespace: downloads
    sources:
      - <<: *app_template
        release: qbittorrent

  calibre:
    namespace: media
    sources:
      - chart: k8s-at-home/calibre
        version: 5.4.2
      - chart: k8s-at-home/calibre-web
        version: 8.4.2
        valueFiles:
          - values-web.yaml

  listen-brainz:
    namespace: media

  photonix:
    namespace: media

  immich:
    namespace: media
    sources:
      - chart: immich/immich
        version: 0.1.2

  typesense:
    namespace: db
    sources:
      - <<: *app_template
        release: typesense

  sonarr:
    namespace: downloads
    sources:
      - <<: *app_template
        release: sonarr

  radarr:
    namespace: downloads
    sources:
      - <<: *app_template
        release: radarr

  readarr:
    namespace: downloads
    sources:
      - <<: *app_template
        release: readarr

  prowlarr:
    namespace: downloads
    sources:
      - <<: *app_template
        release: prowlarr

  overseerr:
    namespace: downloads
    sources:
      - <<: *app_template
        release: overseerr

  lidarr:
    namespace: downloads
    sources:
      - <<: *app_template
        release: lidarr

  netbox:
    namespace: infrastructure
    sources:
      - chart: bootc/netbox
        version: 4.1.1

  linkding:
    namespace: home
    sources:
      - <<: *app_template
        release: linkding

  linkace:
    namespace: home
    sources:
      - <<: *app_template
        release: linkace
    kustomize:
      extras:
        configMapGenerator:
          - name: nginx-config
            files:
              - nginx.conf
            options:
              disableNameSuffixHash: true

  linkwarden:
    namespace: home
    sources:
      - <<: *app_template
        release: linkwarden
