apiVersion: v1
kind: Pod
metadata:
  name: ipa
  namespace: infrastructure
spec:
  containers:
  - image: freeipa/freeipa-server:fedora-38
    name: ipa
    command: ["sh","-c","sleep 1h"]
    resources:
      limits:
        memory: "128Mi"
        cpu: "500m"
    env:
      - name: IPA_SERVER_HOSTNAME
        value: ipa.hermleigh.home
    envFrom:
      - secretRef:
          name: ipa-secret
    volumeMounts:
      - mountPath: /data
        name: ipa-data
      - name: install-options
        mountPath: /data/ipa-server-install-options
        subPath: ipa-server-install-options
  volumes:
    - name: ipa-data
      persistentVolumeClaim:
        claimName: ipa-data
    - name: ipa-secret
      secret:
        secretName: ipa-secret
    - name: install-options
      configMap:
        name: ipa-server-install-options
        items:
          - key: ipa-server-install-options
            path: ipa-server-install-options