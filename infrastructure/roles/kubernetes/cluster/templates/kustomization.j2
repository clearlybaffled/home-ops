{{ ansible_managed | comment }}
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
{% if app.namespace is defined and app.namespace != '' %}
{% set namespace = app.namespace %}
{% else %}
{% set namespace = (app.path | basename) %}
{% endif %}
namespace: {{ namespace }}
{% if app.resources is defined %}

resources:
{% for resource in app.resources %}
  - {{ resource }}
{% endfor %}{% endif %}
{% if app.charts is defined %}

helmCharts:
{% for chart in app.charts %}
  - name: {{ chart.name | default(app.name, true) }}
    repo: {{ helm_repositories[chart.repo] }}
    version: {{ chart.version }}
    valuesFile: {{ chart.valuesFile | default('values.yaml', true)}}
    releaseName: {{ chart.release | default(app.name, true) }}
    namespace: {{ namespace }}{% endfor %}{% endif %}
{{- app.extras if app.extras is defined -}}
