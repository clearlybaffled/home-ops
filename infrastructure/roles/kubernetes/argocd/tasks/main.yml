---
- name: Create argocd namespace
  kubernetes.core.k8s:
    api_version: v1
    kind: Namespace
    definition: |-
      metadata:
        name: argocd

- name: Apply argocd core install manifest
  kubernetes.core.k8s:
    definition: "{{ lookup('url', 'https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/core-install.yaml', split_lines=False) | from_yaml_all | list }}"
    namespace: argocd

- name: Take a breather..
  wait_for:
    timeout: 30

- name: Bootstrap Cluster
  kubernetes.core.k8s:
    definition: "{{ lookup('kubernetes.core.kustomize', dir='cluster/bootstrap') }}"
