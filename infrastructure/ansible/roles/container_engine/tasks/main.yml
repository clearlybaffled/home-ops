---
- name: Download container engine files
  with_items:
    - crun
    - crio
    - crictl
    - skopeo
  ansible.builtin.include_tasks: ../../common/tasks/download_file.yml
  vars:
    download: "{{ download_defaults | combine(downloads[item]) }}"

- name: Copy crun binary from download dir
  ansible.builtin.copy:
    src: "{{ local_release_dir }}/crun"
    dest: "{{ bin_dir }}/crun"
    mode: "0755"
    remote_src: true

- name: Install CRI-O
  ansible.builtin.include_tasks: "cri-o.yml"

- name: Install crictl config
  ansible.builtin.template:
    src: crictl.yaml.j2
    dest: /etc/crictl.yaml
    owner: root
    mode: "0644"

- name: Copy crictl binary from download dir
  ansible.builtin.copy:
    src: "{{ local_release_dir }}/crictl"
    dest: "{{ bin_dir }}/crictl"
    mode: "0755"
    remote_src: true
  notify:
    - Get crictl completion
    - Install crictl completion

- name: Copy skopeo binary from download dir
  copy:
    src: "{{ downloads.skopeo.dest }}"
    dest: "{{ bin_dir }}/skopeo"
    mode: '0755'
    remote_src: true
