---
- name: "crun | Get verion"
  ansible.builtin.command: "{{ bin_dir }}/crun -v"
  register: version_cmd
  changed_when: true
  check_mode: false
  become: false

- name: "crun | Install"
  when: version_cmd.stdout_lines[0] | regex_search(('version ([0-9.]+)'|regex_escape()), '\\1') != downloads.crun.version
  block:
    - name: crun | Download
      ansible.builtin.include_tasks: ../../common/tasks/download_file.yml
      vars:
        download: "{{ download_defaults | combine(downloads.crun) }}"
    - name: crun | Copy binary from download dir
      ansible.builtin.copy:
        src: "{{ local_release_dir }}/crun"
        dest: "{{ bin_dir }}/crun"
        mode: "0755"
        remote_src: true
