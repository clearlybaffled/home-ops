---
- name: "crictl | Get verion"
  ansible.builtin.command: "{{ bin_dir }}/crictl -v"
  register: version_cmd
  changed_when: true
  check_mode: false
  become: false

- name: "crictl | Install"
  when: version_cmd.stdout_lines[0] | regex_search(('version ([0-9.]+)'|regex_escape()), '\\1') != downloads.crictl.version
  block:
    - name: crictl | Download
      ansible.builtin.include_tasks: ../../common/tasks/download_file.yml
      vars:
        download: "{{ download_defaults | combine(downloads.crictl) }}"
    - name: crictl | Install config
      ansible.builtin.template:
        src: crictl.yaml.j2
        dest: /etc/crictl.yaml
        owner: root
        mode: "0644"
    - name: crictl | Copy  binary from download dir
      ansible.builtin.copy:
        src: "{{ local_release_dir }}/crictl"
        dest: "{{ bin_dir }}/crictl"
        mode: "0755"
        remote_src: true
      notify:
        - Get crictl completion
        - Install crictl completion
