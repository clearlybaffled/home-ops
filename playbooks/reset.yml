---
- name: Reset K8S cluster
  hosts: kube_control_plane
  any_errors_fatal: true
  gather_facts: true
  become: true
  tasks:
    - name: Run resets from relevant roles
      include_role:
        name: "{{ item }}"
        tasks_from: reset
      with_items:
        - cluser
        - kubernetes/control_plane
        - containers/network
        - containers/runtime

- name: Tear down terraform stacks
  hosts: localhost
  tasks:
    - name: Tear down {{ item }}
      community.general.terraform:
        project_path: "{{ (infra_dir, 'terraform', item) | path_join }}"
        state: absent
      when: item is directory
      with_fileglob:
        - "{{ infra_dir }}/terraform"
