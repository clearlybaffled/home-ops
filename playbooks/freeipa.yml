---
- name: Generate IPA credentials
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Write out SOPS file to inventory
      community.sops.sops_encrypt:
        path: "{{ ipa_sops_file }}"
        content_yaml:
          ipaadmin_password: "{{ lookup('password','/dev/null', length=30) }}"
          ipadm_password: "{{ lookup('password','/dev/null', length=30) }}"
      when: ipa_sops_file is not file
      vars:
        ipa_sops_file: "{{ (inventory_dir, 'group_vars','ipaserver','credentials.sops.yml') | path_join }}"

          #- name: Create RBD image pool
          #hosts: localhost
          #tasks:
          #- name: Run task
          #include_role:
          #name: server/kvm
          #tasks_from: rbd-pool
- name: Create FreeIPA master
  roles:
    - freeipa

