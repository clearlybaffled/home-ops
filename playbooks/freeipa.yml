---
- name: Provision FreeIPA virtual hosts using terraform
  hosts: localhost
  tasks:
    - name: Provision KVM hosts with terraform
      community.general.terraform:
        project_path: "{{ infra_dir }}/terraform/ipa"

    - name: Refresh inventory
      meta: "refresh_inventory"

- name: Wait for vm
  hosts: tang
  gather_facts: false
  tasks:
    - name: Wait for host to be ready
      wait_for_connection:
        delay: 10
        sleep: 30
