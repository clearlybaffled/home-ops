---
- name: Gather Cluster Facts
  hosts: k8s_cluster
  gather_facts: true

- name: Kubernetes Node setup
  hosts: kube_node
  gather_facts: true
  any_errors_fatal: true
  roles:
    - common
    - role: download
      tags: download
      vars:
        download_container: false
      when: not skip_downloads
    - kubernetes/node

- name: Install Container Engine
  hosts: kube_node
  gather_facts: false
  any_errors_fatal: true
  roles:
    - container_engine
    - { role: download, tags: download, when: not skip_downloads }

- name: Set up control plane
  hosts: kube_control_plane
  gather_facts: false
  any_errors_fatal: true
  roles:
    - common
    - kubernetes/control_plane
    - kubernetes/cni

- name: Install Apps
  hosts: kube_control_plane
  gather_facts: false
  roles:
    - argocd
  tags:
    - apps
