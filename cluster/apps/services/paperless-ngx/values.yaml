global:
  nameOverride: paperless

controllers:
  main:
    type: deployment
    containers:
      main:
        image:
          repository: ghcr.io/paperless-ngx/paperless-ngx
          tag: 2.4.3
        env:
          PAPERLESS_CONSUMER_POLLING: 60
          PAPERLESS_CONSUMER_RECURSIVE: "true"
          PAPERLESS_CONSUMER_SUBDIRS_AS_TAGS: "true"
          PAPERLESS_CONSUMER_ENABLE_COLLATE_DOUBLE_SIDED: "true"
          PAPERLESS_CONSUMPTION_DIR: /consume
          PAPERLESS_DBENGINE: postgresql
          PAPERLESS_DBHOST: cnpg-cluster-rw.db.svc
          PAPERLESS_DATA_DIR: /library/data
          PAPERLESS_EXPORT_DIR: /library/export
          PAPERLESS_MEDIA_ROOT: /library/media
          PAPERLESS_TRASH_DIR: /trash
          PAPERLESS_OCR_LANGUAGE: eng
          PAPERLESS_OCR_MODE: skip
          PAPERLESS_OCR_ROTATE_PAGES: "true"
          PAPERLESS_OCR_IMAGE_DPI: 300
          PAPERLESS_PORT: &port 8080
          PAPERLESS_TASK_WORKERS: 2
          PAPERLESS_TIME_ZONE: &tz America/New_York
          PAPERLESS_TIKA_ENABLED: 1
          PAPERLESS_TIKA_GOTENBERG_ENDPOINT: http://localhost:3000
          PAPERLESS_TIKA_ENDPOINT: http://localhost:9998
          PAPERLESS_URL: https://paperless.hermleigh.home
          PAPERLESS_REDIS: redis://redis-master.db.svc:6379
          USERMAP_UID: 997
          USERMAP_GID: 997
          TZ: America/New_York
        envFrom:
          - secretRef:
              name: paperless-ngx-secret
        resources:
          requests:
            cpu: 100m
            memory: 1000Mi
          limits:
            memory: 5000Mi

      gotenburg:
        image:
          repository: thecodingmachine/gotenberg
          tag: 8.0.2
        imagePullPolicy: IfNotPresent
        env:
          - name: DISABLE_GOOGLE_CHROME
            value: "1"

      tika:
        image:
          repository: ghcr.io/paperless-ngx/tika
          tag: 2.9.0-full
        imagePullPolicy: IfNotPresent

      hp-scan-to:
        image: &hp-scan-to
          repository: manuc66/node-hp-scan-to
          tag: master
        env:
          - name: LABEL
            value: paperless-ngx
          - name: DIR
            value: /consume
          - name: CMDLINE
            value: "-D -l paperless-ngx -r 300 "
        envFrom:
          - configMapRef:
              name: hp-scan-to-env
        resources:
          limits:
            memory: 256Mi
          requests:
            cpu: "0"
            memory: 64Mi
      hp-scan-to-double-sided:
        image: *hp-scan-to
        envFrom:
          - configMapRef:
              name: hp-scan-to-env
        env:
          - name: LABEL
            value: paperless-ngx (double sided)
          - name: CMDLINE
            value: '-D -l "paperless-ngx (double sided)" -r 300'
          - name: DIR
            value: /consume/double-sided

service:
  main:
    ports:
      http:
        port: *port
ingress:
  main:
    enabled: true
    className: nginx
    annotations:
      cert-manager.io/cluster-issuer: ca-issuer
      gethomepage.dev/enabled: "true"
      gethomepage.dev/group: "Apps & Services"
      gethomepage.dev/icon: paperless-ngx.png
      gethomepage.dev/description: "Scan, index and archive all your physical documents"
      gethomepage.dev/name: Paperless-NGX
    hosts:
      - host: &host paperless.hermleigh.home
        paths:
          - path: /
            service:
              name: main
              port: http
    tls:
      - hosts:
          - *host
          - paperless
        secretName: paperless-tls-ingress

persistence:
  library:
    enabled: true
    type: persistentVolumeClaim
    accessMode: ReadWriteMany
    size: 30Gi
    storageClass: ceph-fs-ssd
    globalMounts:
      - path: /library
  trash:
    enabled: true
    type: emptyDir
    globalMounts:
      - path: /trash
  consume:
    existingClaim: paperless-consume
  consume-double-sided:
    enabled: true
    type: emptyDir
    globalMounts:
      - path: /consume/double-sided

defaultPodOptions:
  podSecurityContext:
    # runAsUser: 997
    # runAsGroup: 997
    fsGroup: 997
