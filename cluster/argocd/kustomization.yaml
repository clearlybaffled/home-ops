# BEGIN ANSIBLE MANAGED BLOCK
#
# template: infrastructure/roles/cluster/templates/kustomization.yaml.j2
# date: 2023-07-18 17:02:06
# user: clearlybaffled
# host: parche
# commit: 1917aa4
#
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: argocd

resources:
  - https://github.com/cert-manager/cert-manager/releases/download/v1.12.0/cert-manager.crds.yaml
  - ns.yaml

helmCharts:
  - name: argo-cd
    repo: https://argoproj.github.io/argo-helm
    version: 5.36.2
    valuesFile: values.yaml
    includeCRDs: true
    releaseName: argocd
    namespace: argocd

  - name: prometheus-operator-crds
    repo: https://prometheus-community.github.io/helm-charts
    version: 4.0.2
    valuesFile: values.yaml
    includeCRDs: true
    releaseName: prometheus-operator-crds
    namespace: monitoring


# END ANSIBLE MANAGED BLOCK

patches:
  - patch: |-
      - op: add
        path: /spec/template/spec/containers/0/env/-
        value: {name: ARGOCD_SYNC_WAVE_DELAY, value: "30"}
    target:
      version: v1
      group: apps
      kind: StatefulSet
      name: argocd-application-controller
      labelSelector: "app.kubernetes.io/name=argocd-application-controller"
